<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resample bullet signatures  • bulletsamplr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Resample bullet signatures ">
<meta property="og:description" content="Resamples land signatures from NIST's NRBTD or from provided data, 
    with the goal of examining the distribution of match scores from randomly
    generated distributions.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">bulletsamplr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="bulletsamplr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#bulletsamplr" class="anchor"></a>bulletsamplr</h1></div>

<p>The goal of bulletsamplr is to create bullet signatures which can be used to examine the behavior of match statistics under truly random conditions.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of bulletsamplr from <a href="https://github.com/srvanderplas/bulletsamplr">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"srvanderplas/bulletsamplr"</span>)</a></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(bulletsamplr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(bulletxtrctr)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">library</span>(stringr)</a></code></pre></div>
<div id="creating-cycles-for-resampling" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-cycles-for-resampling" class="anchor"></a>Creating cycles for resampling</h3>
<p>We start with a signature from a scanned bullet land:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">data</span>(sig)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> sig), <span class="dt">data =</span> sig) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Original Signature"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.title =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(), <span class="dt">axis.text.x =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>())</a></code></pre></div>
<div class="figure">
<img src="reference/figures/README-unnamed-chunk-1-1.png" alt="Land Signature" width="100%"><p class="caption">
Land Signature
</p>
</div>
<p>The threshold bootstrap creates new sequences by resampling “cycles” from actual data. These cycles are created as follows:</p>
<p>First, the median of the signature is used to divide the signature into <strong>cycles</strong> of one positive and one negative region of the signature (relative to the median value).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">threshold &lt;-<span class="st"> </span><span class="kw">median</span>(sig<span class="op">$</span>sig, <span class="dt">na.rm =</span> T)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> sig), <span class="dt">data =</span> sig) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_hline</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">yintercept =</span> threshold), <span class="dt">color =</span> <span class="st">"red"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Threshold used to create cycles for future sample signatures"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.title =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(), <span class="dt">axis.text.x =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>())</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; Warning: Removed 265 rows containing missing values (geom_path).</span></a></code></pre></div>
<div class="figure">
<img src="reference/figures/README-unnamed-chunk-2-1.png" alt="Land Signature. Cycles are created when the sequence crosses the median, and include one positive region and one negative region. This ensures continuity between adjacent segments." width="100%"><p class="caption">
Land Signature. Cycles are created when the sequence crosses the median, and include one positive region and one negative region. This ensures continuity between adjacent segments.
</p>
</div>
<p>These divisions are shown below, with each segment in a different color; adjacent segments are disjoint.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">sig_slices &lt;-<span class="st"> </span><span class="kw"><a href="reference/crosscut_slice.html">crosscut_slice</a></span>(sig) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(.chunk) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="co"># mutate(x = x - mean(x, na.rm = T)) %&gt;%</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">sig_slices <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(.chunk) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">x =</span> <span class="kw">ifelse</span>(.chunk <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(sig_slices<span class="op">$</span>.chunk), <span class="kw">rev</span>(x), x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sig =</span> <span class="kw">ifelse</span>(.chunk <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(sig_slices<span class="op">$</span>.chunk), <span class="op">-</span>sig, sig)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.chunk, x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">xnew =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> ., <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> xnew<span class="op">*</span><span class="fl">1.5625</span>, <span class="dt">y =</span> sig, <span class="dt">color =</span> <span class="kw">factor</span>(.chunk))) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_hue">scale_color_discrete</a></span>(<span class="st">"Chunk"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Cycles (and boundary regions)"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.title =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(), <span class="dt">axis.text.x =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>())</a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; Warning: Removed 265 rows containing missing values (geom_path).</span></a></code></pre></div>
<p><img src="reference/figures/README-chunk-slices-1.png" width="100%"></p>
<p>The cycles are then post-processed so that they all share the same orientation (positive portion of the cycle first); this requires that the boundary chunks be oriented so that the final portion of the chunk is negative. End chunks are thus reversed (in x) and may be flipped in y depending on the original orientation.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">sig_slices<span class="op">$</span>chunk_label &lt;-<span class="st"> </span><span class="kw">factor</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  sig_slices<span class="op">$</span>.chunk, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"boundary_start"</span>, </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">             <span class="kw">paste</span>(<span class="st">"cycle"</span>, <span class="kw">unique</span>(sig_slices<span class="op">$</span>.chunk)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">max</span>(sig_slices<span class="op">$</span>.chunk))]), </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">             <span class="st">"boundary_end"</span>))</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> sig, <span class="dt">group =</span> .chunk), <span class="dt">data =</span> sig_slices) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>chunk_label, <span class="dt">scales =</span> <span class="st">"free"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.title =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>()) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Sliced Land Signature"</span>)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; Warning: Removed 265 rows containing missing values (geom_path).</span></a></code></pre></div>
<div class="figure">
<img src="reference/figures/README-unnamed-chunk-3-1.png" alt="Slices of land signature. Note that the boundary_end slice has been reversed (in x) and flipped (in y) so that it is 'in phase' with the positive-to-negative cycles in the main portion of the signature." width="100%"><p class="caption">
Slices of land signature. Note that the boundary_end slice has been reversed (in x) and flipped (in y) so that it is ‘in phase’ with the positive-to-negative cycles in the main portion of the signature.
</p>
</div>
<p>The cycles can then be saved to a database, or the data frame of cycles can be reassembled directly into new sequences. Ideally, of course, new sequences would be assembled from a library composed of cycles from many different signatures.</p>
</div>
<div id="resampling-cycles-to-create-new-sequences" class="section level3">
<h3 class="hasAnchor">
<a href="#resampling-cycles-to-create-new-sequences" class="anchor"></a>Resampling cycles to create new sequences</h3>
<p>This portion of the tutorial will use cycles derived from Barrel 1, Bullets 1 and 2 of the Hamby 252 series, downloaded from NIST (the <code>x3ptools</code> package includes these bullets). The <a href="https://heike.github.io/bulletxtrctr/index.html"><code>bulletxtrctr</code> demo</a> has code for obtaining and processing these files to obtain the signatures used to create the <code>signature_slices</code> object.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Load sample signature slices</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">data</span>(signature_slices)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co"># 171 different sequences</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">length</span>(<span class="kw">unique</span>(signature_slices<span class="op">$</span>id)) </a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; [1] 171</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co"># Sequence types</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">signature_slices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(id, type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">count</a></span>()</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; # Groups:   type [2]</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;   type         n</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; 1 boundary    24</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; 2 pn         147</span></a></code></pre></div>
<p>The 12 lands used to create signature_slices produced 171 sequences, of which 24 are boundary sequences and do not contain complete cycles, and 147 are complete cycles, oriented so that the positive portion of the cycle comes first.</p>
<p>First, we choose a target signature length. The two bullets used to derive these sequences have an average signature length of 1511.333, so a target signature length of 1500 will produce sequences approximately the same as the original signatures.</p>
<p>In the call to crosscut_assemble, we specify the output resolution to be 1.5625 microns, which is the resolution of the original scans.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">309240538</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">seq1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/crosscut_assemble.html">crosscut_assemble</a></span>(<span class="dv">1500</span>, signature_slices, <span class="dt">output_res =</span> <span class="fl">1.5625</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(seq1, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> sig)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>()</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; Warning: Removed 148 rows containing missing values (geom_path).</span></a></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<p>We can use the assembled sequence to assess the distribution of features created by <code>bulletxtrctr</code> under the null distribution:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">20401889</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co"># Assemble n sequences from signature_slices</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">seqs &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_df</a></span>(<span class="dv">1</span><span class="op">:</span>n, </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="op">~</span><span class="kw"><a href="reference/crosscut_assemble.html">crosscut_assemble</a></span>(<span class="dt">len =</span> <span class="dv">1500</span>, <span class="dt">df =</span> signature_slices, <span class="dt">output_res =</span> <span class="fl">1.5625</span>), </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">.id =</span> <span class="st">'rep'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">rep =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_pad">str_pad</a></span>(rep, <span class="dv">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span>))</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(seqs, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> sig, <span class="dt">group =</span> rep)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>rep)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; Warning: Removed 2368 rows containing missing values (geom_path).</span></a></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">chunks_per_seq &lt;-<span class="st"> </span>seqs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(rep) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(rep, id, .idx) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">chunks =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>())</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">seq_replications &lt;-<span class="st"> </span>seqs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(rep, id, .idx) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">chunks =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>())</a></code></pre></div>
<p>Each sequence had between 11 and 21 chunks composed of a cycle or a partial cycle (in the case of a boundary region). With 171 chunks available, we would expect that each chunk was re-used around 10.0588235 times (note that the library of cycles is kept small for demonstration purposes; in real life, we would want a much larger library). In fact, each chunk was used between 1 and 5 times.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Nest generated sequences</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">nested_seqs &lt;-<span class="st"> </span>seqs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">nest</a></span>(<span class="op">-</span>rep, <span class="dt">.key =</span> sig)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"># Set up comparison matrix</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">alignments &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/expand">crossing</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">data_frame</a></span>(<span class="dt">seq1 =</span> <span class="kw">unique</span>(seqs<span class="op">$</span>rep)),</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">                              <span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">data_frame</a></span>(<span class="dt">seq2 =</span> <span class="kw">unique</span>(seqs<span class="op">$</span>rep))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(seq1 <span class="op">!=</span><span class="st"> </span>seq2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(nested_seqs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"seq1"</span> =<span class="st"> "rep"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">sig1 =</span> sig) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(nested_seqs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"seq2"</span> =<span class="st"> "rep"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">sig2 =</span> sig)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co"># Function to compute rows of overlap</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">overlap_by_chance &lt;-<span class="st"> </span><span class="cf">function</span>(df1, df2) {</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">  <span class="kw">mean</span>(df1<span class="op">$</span>id[<span class="op">!</span><span class="kw">is.na</span>(df1<span class="op">$</span>sig)] <span class="op">%in%</span><span class="st"> </span>df2<span class="op">$</span>id[<span class="op">!</span><span class="kw">is.na</span>(df2<span class="op">$</span>sig)])</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb11-19" data-line-number="19">alignments &lt;-<span class="st"> </span>alignments <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">    <span class="dt">overlap =</span> purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">map2_dbl</a></span>(<span class="dt">.x =</span> sig1, <span class="dt">.y =</span> sig2, overlap_by_chance),</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">    <span class="dt">aligned =</span> purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">map2</a></span>(<span class="dt">.x =</span> sig1, <span class="dt">.y =</span> sig2, <span class="op">~</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bulletxtrctr/topics/sig_align">sig_align</a></span>(.x<span class="op">$</span>sig, .y<span class="op">$</span>sig)),</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">    <span class="dt">striae =</span> purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(aligned, sig_cms_max, <span class="dt">span =</span> <span class="dv">75</span>)</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">    <span class="dt">features =</span> purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">map2</a></span>(<span class="dt">.x =</span> aligned, <span class="dt">.y =</span> striae, <span class="dt">.f =</span> extract_features_all, <span class="dt">resolution =</span> <span class="fl">1.5625</span>)</a>
<a class="sourceLine" id="cb11-27" data-line-number="27">  )</a></code></pre></div>
<p>With a cycle library of 171 chunks, we can expect that significant overlap between resampled sequences might occur. Thus, the conclusions drawn about the null distribution of features in this README should not be extrapolated; much different (and better) results should be expected when using a feature library of sufficient size.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(alignments, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> seq1, <span class="dt">y =</span> seq2, <span class="dt">fill =</span> overlap)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_tile">geom_tile</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_gradient">scale_fill_gradient</a></span>(<span class="st">"Proportion</span><span class="ch">\n</span><span class="st">overlap b/w</span><span class="ch">\n</span><span class="st">Sequence 1,</span><span class="ch">\n</span><span class="st">Sequence2"</span>, <span class="dt">low =</span> <span class="st">"white"</span>, <span class="dt">high =</span> <span class="st">"red"</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_fixed">coord_fixed</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Resampled Sequence 1"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Resampled Sequence 2"</span>)</a></code></pre></div>
<div class="figure">
<img src="reference/figures/README-unnamed-chunk-9-1.png" alt="Proportion of values of sequence 1 which overlap with sequence 2" width="100%"><p class="caption">
Proportion of values of sequence 1 which overlap with sequence 2
</p>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">features &lt;-<span class="st"> </span>alignments <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(seq1, seq2, features) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">unnest</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(<span class="dt">key =</span> <span class="st">"var"</span>, <span class="dt">value =</span> <span class="st">"value"</span>, <span class="op">-</span>seq1, <span class="op">-</span>seq2)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">features <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_detect">str_detect</a></span>(var, <span class="st">"_mm"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>var, <span class="dt">scales =</span> <span class="st">"free"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Distribution of Features for Resampled Sequences"</span>)</a></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Report a bug at <br><a href="NA">NA</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Susan Vanderplas <br><small class="roles"> Author, maintainer </small>  </li>
<li>Heike Hofmann <br><small class="roles"> Author </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://choosealicense.com/"><img src="https://img.shields.io/badge/license-MIT%20+%20file%20LICENSE-lightgrey.svg" alt="license"></a></li>
<li><a href="https://cran.r-project.org/package=bulletsamplr"><img src="https://www.r-pkg.org/badges/version/bulletsamplr" alt="CRAN status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="lifecycle"></a></li>
<li><a href="/commits/master"><img src="https://img.shields.io/badge/last%20change-2018--10--22-yellowgreen.svg" alt="Last-changedate"></a></li>
<li><a href="https://travis-ci.org/srvanderplas/bulletsamplr"><img src="https://travis-ci.org/srvanderplas/bulletsamplr.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/github/srvanderplas/bulletsamplr?branch=master"><img src="https://codecov.io/gh/srvanderplas/bulletsamplr/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Susan Vanderplas, Heike Hofmann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
